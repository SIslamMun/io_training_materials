Help us improve by taking our short survey: <https://www.hdfgroup.org/website-survey/>
![Logo](https://support.hdfgroup.org/documentation/hdf5/latest/HDFG-logo.png) |  HDF5 Last Updated on 2026-01-10 The HDF5 Field Guide  
---|---  
  * [Main Page](https://support.hdfgroup.org/documentation/hdf5/latest/index.html)
  * [Getting started](https://support.hdfgroup.org/documentation/hdf5/latest/_getting_started.html)
  * [User Guide](https://support.hdfgroup.org/documentation/hdf5/latest/_u_g.html)
  * [Reference Manual](https://support.hdfgroup.org/documentation/hdf5/latest/_r_m.html)
  * [Cookbook](https://support.hdfgroup.org/documentation/hdf5/latest/_cookbook.html)
  * [Technical Notes](https://support.hdfgroup.org/documentation/hdf5/latest/_t_n.html)
  * [RFCs](https://support.hdfgroup.org/documentation/hdf5/latest/_r_f_c.html)
  * [Specifications](https://support.hdfgroup.org/documentation/hdf5/latest/_s_p_e_c.html)
  * [Glossary](https://support.hdfgroup.org/documentation/hdf5/latest/_g_l_s.html)
  * [Full-Text Search](https://support.hdfgroup.org/documentation/hdf5/latest/_f_t_s.html)
  * [About](https://support.hdfgroup.org/documentation/hdf5/latest/_about.html)
  * [![](https://support.hdfgroup.org/documentation/hdf5/latest/search/close.svg)](javascript:searchBox.CloseResultsWindow\(\))


### Table of contents
  * [ Copying Committed Datatypes with H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/copying_committed.html#title0 "H1")
  * [ Callback Function](https://support.hdfgroup.org/documentation/hdf5/latest/copying_committed.html#title1 "H2")
  * [ Function Summary](https://support.hdfgroup.org/documentation/hdf5/latest/copying_committed.html#title2 "H2")
  * [ Resources](https://support.hdfgroup.org/documentation/hdf5/latest/copying_committed.html#title3 "H2")


[•All](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))[](javascript:void\(0\))
Loading...
Searching...
No Matches
Copying Committed Datatypes with H5Ocopy
Navigate back: [Main](https://support.hdfgroup.org/documentation/hdf5/latest/index.html) / [HDF5 User Guide](https://support.hdfgroup.org/documentation/hdf5/latest/_u_g.html) / [Additional Resources](https://support.hdfgroup.org/documentation/hdf5/latest/_a_r__u_g.html)
* * *
HDF5 Release 1.8.9 May 2012
#  Copying Committed Datatypes with H5Ocopy
Committed datatypes can be a powerful feature in HDF5. They can be used to share a single datatype description among multiple datasets, to save space or ensure that the datatypes are truly identical, and to assign a name to that datatype within the HDF5 group structure. The object copy API, [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file."), can be used to copy HDF5 objects from one file to another, including committed datatypes and objects that use them. However, problems can occur when a dataset using a committed datatype or an object with an attribute that uses a committed datatype is copied to another file with [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.").
When copying a dataset that uses a committed datatype or an object with an attribute that uses a committed datatype between files, the library by default does not look for a matching committed datatype in the destination file. The library creates a new committed datatype in the destination file without any links to it (an anonymous committed datatype) and then links the dataset to the anonymous committed datatype. This means that, when copying multiple datasets in separate calls to [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file."), a new committed datatype is created for each [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") call. While it is possible to have all of the copied datasets share the same committed datatype by copying them in a single call to [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file."), this is not always attainable.
For example, imagine that a user has an application that automatically creates many data files, each with many datasets that all use a single committed datatype. At the end of a project, the user wants to merge all of these files into a single file. The HDF5 Library can have all of the datasets in the combined file use the same committed datatype, but the default behavior of the library is to create an anonymous committed datatype for each dataset.
To make sure that shared committed datatypes in the source are shared in the copy, use the [H5Pset_copy_object](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6 "Sets properties to be used when an object is copied.") property list API routine to set the [H5O_COPY_MERGE_COMMITTED_DTYPE_FLAG](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_opublic_8h.html#a11355b69cd246ae15e7d4c53cd210bd8) flag. When this flag is set and [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") encounters an object or attribute that uses a committed datatype, H5Ocopy will search for a matching committed datatype in the destination file. If a matching committed datatype is found, then it will be used by the copied dataset or attribute. The next few paragraphs describe in more detail the process that [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") goes through.
When the [H5O_COPY_MERGE_COMMITTED_DTYPE_FLAG](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_opublic_8h.html#a11355b69cd246ae15e7d4c53cd210bd8) flag is set, H5Ocopy will search the destination file for committed datatypes and build a temporary list in memory of all the committed datatypes it finds. Then, whenever H5Ocopy encounters a dataset that uses a committed datatype or an object with an attribute that uses a committed datatype in the source, it will check that list to see if it contains a datatype equal to the source datatype. If [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") finds an equal datatype, it will modify the copied object or attribute to use the found committed datatype as its datatype. [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") will then update the list if a new committed datatype is created in the destination file as a result of the copy. When later datasets and attributes using committed datatypes are encountered, the library will again check to see if the list contains a matching datatype.
To determine if two committed datatypes are equal, the library will compare their descriptions in a manner similar to [H5Tequal](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_t.html#gaa92250f289b557b63cba974defa20b0f "Determines whether two datatype identifiers refer to the same datatype."). In addition, if either committed datatype has one or more attributes, then all attributes must be present in both committed datatypes, and the attributes must all be identical. Each attribute’s datatype description, dataspace, and raw data must be identical. However, if an attribute uses a committed datatype, then the attributes of the attribute’s committed datatype will not be compared.
When [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") encounters a committed datatype object in the source file, it will similarly search for a matching committed datatype in the destination file. If a match is found, the library will create a hard link in the destination file to the found datatype. If a match is not found, the library will copy the committed datatype normally and add it to the temporary list of committed datatypes in the destination file.
By default, [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") will search the entire destination file for a matching committed datatype. It is possible to focus where [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") will search. This focusing should result in a faster search. If there are locations in the destination file where a matching committed datatype might be found, then those locations can be specified with the [H5Padd_merge_committed_dtype_path](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f "Adds a path to the list of paths that will be searched in the destination file for a matching committ...") property.
The example below shows how to enable the feature described above for use with [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.").
_Example1. Setting the object copy property list_
[hid_t](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_ipublic_8h.html#a0045db7ff9c22ad35db6ae91662e1943) ocpypl_id;
ocpypl_id = [H5Pcreate](https://support.hdfgroup.org/documentation/hdf5/latest/group___p_l_c_r.html#gaf1b11da01d4d45d788c45f8bc5f0cbfa)([H5P_OBJECT_COPY](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_ppublic_8h.html#a7cedfd989522e8d7697a414d1d707e43));
status = [H5Pset_copy_object](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6)(ocpypl_id, H5O_COPY_MERGE_COMMITTED_DT_FLAG);
status = [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225)(file1_id, src_name, file2_id, dst_name, ocpypl_id, [H5P_DEFAULT](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_ppublic_8h.html#afa85e97bfbf9bf1c58e39263846c568f));
[hid_t](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_ipublic_8h.html#a0045db7ff9c22ad35db6ae91662e1943)
int64_t hid_t
**Definition** H5Ipublic.h:60
[H5P_OBJECT_COPY](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_ppublic_8h.html#a7cedfd989522e8d7697a414d1d707e43)
#define H5P_OBJECT_COPY
**Definition** H5Ppublic.h:112
[H5P_DEFAULT](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_ppublic_8h.html#afa85e97bfbf9bf1c58e39263846c568f)
#define H5P_DEFAULT
**Definition** H5Ppublic.h:220
[H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225)
herr_t H5Ocopy(hid_t src_loc_id, const char *src_name, hid_t dst_loc_id, const char *dst_name, hid_t ocpypl_id, hid_t lcpl_id)
Copies an object in an HDF5 file.
[H5Pset_copy_object](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6)
herr_t H5Pset_copy_object(hid_t plist_id, unsigned copy_options)
Sets properties to be used when an object is copied.
[H5Pcreate](https://support.hdfgroup.org/documentation/hdf5/latest/group___p_l_c_r.html#gaf1b11da01d4d45d788c45f8bc5f0cbfa)
hid_t H5Pcreate(hid_t cls_id)
Creates a new property list as an instance of a property list class.
##  Callback Function
If no matching datatype is found in the locations specified by the call to [H5Padd_merge_committed_dtype_path](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f "Adds a path to the list of paths that will be searched in the destination file for a matching committ..."), then [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") will by default search the entire destination file. In some cases, this may not be desirable. For instance, the user may expect the datatype to always have a match in the specified locations and may wish to return an error if a match is not found. The user may also have a very large file for which the full search incurs a substantial performance penalty. In this instance, the user may wish to log these events so that other datatypes can be added with [H5Padd_merge_committed_dtype_path](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f "Adds a path to the list of paths that will be searched in the destination file for a matching committ..."), or the user may wish to abort the search and copy the datatype normally.
To support these use cases, the functions [H5Pset_mcdt_search_cb](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1 "Sets the callback function that H5Ocopy\(\) will invoke before searching the entire destination file fo...") and [H5Pget_mcdt_search_cb](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga5d7b82394d37bda28769a0435300d396 "Retrieves the callback function from the specified object copy property list.") have been added. These functions allow the user to define a callback function that will be called every time the list of paths added by [H5Padd_merge_committed_dtype_path](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f "Adds a path to the list of paths that will be searched in the destination file for a matching committ...") has been exhausted but before beginning the full search of the file. The prototype for the callback function is defined by [H5O_mcdt_search_cb_t](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_opublic_8h.html#aa35611ba3daa73768194274c0e2a20eb). The only argument to the callback function is a user supplied user data pointer, and the return value is an enum, defined by [H5O_mcdt_search_ret_t](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_opublic_8h.html#a500f24019516869a4a61ac7efcb3b29b), which tells the library to either continue with the full file search, abort the search and copy the datatype normally (create a new committed datatype in the destination file), or return an error.
##  Function Summary
Functions used in committed datatype copying operations are listed below. 
Committed Datatype Copying Related Functions Function | Purpose   
---|---  
[H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") | Allows an application to copy an object within an HDF5 file or to another HDF5 file.   
[H5Pset_copy_object](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6 "Sets properties to be used when an object is copied.") | Allows an application to set properties to be used when an object is copied.   
[H5Padd_merge_committed_dtype_path](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f "Adds a path to the list of paths that will be searched in the destination file for a matching committ...") | Allows an application to add a path to the list of paths that will be searched in the destination file for a matching committed datatype.   
[H5Pfree_merge_committed_dtype_paths](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga4b8d6496ac56b167dba16729a8bd7adf "Clears the list of paths stored in the object copy property list.") | Allows an application to clear the list of paths stored in the object copy property list **ocpypl_id**.   
[H5Pset_mcdt_search_cb](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1 "Sets the callback function that H5Ocopy\(\) will invoke before searching the entire destination file fo...") | Allows an application to set the callback function that [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") will invoke before searching the entire destination file for a matching committed datatype.   
[H5Pget_mcdt_search_cb](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga5d7b82394d37bda28769a0435300d396 "Retrieves the callback function from the specified object copy property list.") | Allows an application to retrieve the callback function from the specified object copy property list.   
[H5O_mcdt_search_cb_t](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_opublic_8h.html#aa35611ba3daa73768194274c0e2a20eb) | Definition of the callback function set by [H5Pset_mcdt_search_cb](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1 "Sets the callback function that H5Ocopy\(\) will invoke before searching the entire destination file fo..."). Provides the mechanism by which a user application may set an action for [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.") to take after checking all suggested paths for a matching committed datatype but before starting the global search of the destination file.   
##  Resources
See the following for more information.
See the [HDF5 Datatypes](https://support.hdfgroup.org/documentation/hdf5/latest/_h5_t__u_g.html#sec_datatype) chapter in the [HDF5 User Guide](https://support.hdfgroup.org/documentation/hdf5/latest/_u_g.html).
See these entries in the [HDF5 Reference Manual](https://support.hdfgroup.org/documentation/hdf5/latest/_r_m.html)
  * [H5Ocopy](https://support.hdfgroup.org/documentation/hdf5/latest/group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225 "Copies an object in an HDF5 file.")
  * [H5Pset_copy_object](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6 "Sets properties to be used when an object is copied.")
  * [H5Padd_merge_committed_dtype_path](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f "Adds a path to the list of paths that will be searched in the destination file for a matching committ...")
  * [H5Pfree_merge_committed_dtype_paths](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga4b8d6496ac56b167dba16729a8bd7adf "Clears the list of paths stored in the object copy property list.")
  * [H5Pset_mcdt_search_cb](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1 "Sets the callback function that H5Ocopy\(\) will invoke before searching the entire destination file fo...")
  * [H5Pget_mcdt_search_cb](https://support.hdfgroup.org/documentation/hdf5/latest/group___o_c_p_y_p_l.html#ga5d7b82394d37bda28769a0435300d396 "Retrieves the callback function from the specified object copy property list.")


* * *
Navigate back: [Main](https://support.hdfgroup.org/documentation/hdf5/latest/index.html) / [HDF5 User Guide](https://support.hdfgroup.org/documentation/hdf5/latest/_u_g.html) / [Additional Resources](https://support.hdfgroup.org/documentation/hdf5/latest/_a_r__u_g.html)
  * Generated by [![doxygen](https://support.hdfgroup.org/documentation/hdf5/latest/doxygen.svg)](https://www.doxygen.org/index.html) 1.13.2 


